#! /bin/bash

CACHE_DIR="$HOME/.r-mirror"

GITHUB_BASE="https://github.com/mbrendler"

function r_mirror_run_push() {
  hg push
  local repo_name="$(basename "$(hg paths default)")"
  local cache_dir="$CACHE_DIR/$repo_name.git"
  mkdir -p "$cache_dir"
  git init --bare "$cache_dir"
  hg book -r tip master
  hg push "$cache_dir"
  git -C "$cache_dir" push "$GITHUB_BASE/$repo_name.git" master
}

r_mirror_run_push
