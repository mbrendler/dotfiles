#! /bin/bash
# vim: set filetype=sh :

TERM=xterm-256color

if test -z "$TMUX_CMD" ; then
    TMUX_CMD=tmux
fi

if test -z "$TMUXES_DIR" ; then
    TMUXES_DIR=$HOME/.tmuxes
fi

function usage() {
    echo usage: $0 TMUXES_NAME \| COMMAND
    echo
    echo '  Commands:'
    echo '    edit TMUXES_NAME    edit TMUXES_NAME script file'
    echo '    list                list all TMUXES_NAMEs'
    exit 1
}

if test $# -eq 0 ; then
    usage
fi

case "$1" in
    'edit' )
        if test $# -gt 1 ; then
            $EDITOR $TMUXES_DIR/$2.sh
        else
            usage
        fi
        exit 0
        ;;

    'list' )
        for file in $(/bin/ls $TMUXES_DIR/*.sh) ; do
            echo $(basename $file) | sed -e 's/\.sh//'
        done
        exit 0
        ;;
esac

NAME=$1
SCRIPT_FILE=$HOME/.tmuxes/$NAME.sh

if ! $TMUX_CMD has-session -t $NAME ; then
    echo "new session: $NAME"
    if test -e $SCRIPT_FILE ; then
        source $SCRIPT_FILE
    else
        $TMUX_CMD -2 new-session -s $NAME
    fi
fi

$TMUX_CMD attach-session -t $NAME
